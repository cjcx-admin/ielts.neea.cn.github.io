function computeMoney() {
    var a = 0;
    $("[name='paymentType']:checked").each(function() {
        a = a + getAmountOfMoney($(this).val())
    });
    if (!$("#bmf").attr("checked")) {
        $("#bmfcount").val(0)
    }
    if (!$("#bmfIELTSUKVI").attr("checked")) {
        $("#bmfcountIELTSUKVI").val(0)
    }
    if (!$("#bmfIELTSLS").attr("checked")) {
        $("#bmfcountIELTSLS").val(0)
    }
    if (!$("#zkf").attr("checked")) {
        $("#zkfcount").val(0)
    }
    if (!$("#fyf").attr("checked")) {
        $("#fyfcount").val(0)
    }
    if (!$("#lsfyf").attr("checked")) {
        $("#lsfyfcount").val(0)
    }
    if (!$("#rti").attr("checked")) {
        $("#rticount").val(0)
    }
    if ($("#cef").attr("checked")) {
        a = a + parseInt($("#difference").val());
        $("#cefchoose").val($("#cefSelect").val())
    } else {
        $("#cefchoose").val(0)
    }
    $("#hiddenAmount").val(a);
    formatCurrency("total", a)
}

function getDifference() {
    var a = $("#cefSelect").val();
    if (a > 0) {
        var b = $("#balance").val();
        var c = 0;
        if (a - b > 0) {
            c = a - b
        } else {
            if (a - b == 0) {
                c = 0
            } else {
                if (a - b < 0) {
                    c = 0
                }
            }
        }
        $("#difference").val(c);
        formatCurrency("cdfVal", c)
    } else {
        $("#difference").val(0);
        formatCurrency("cdfVal", 0)
    }
    computeMoney()
}

function getAmountOfMoney(b) {
    var c = 0;
    var a = 0;
    if (b == "newOrder") {
        c = $("#newOrderPrice").val();
        a = $("#bmfSelect").val();
        $("#bmfcount").val(a)
    } else {
        if (b == "newOrderIELTSUKVI") {
            c = $("#newOrderPriceIELTSUKVI").val();
            a = $("#bmfSelectIELTSUKVI").val();
            $("#bmfcountIELTSUKVI").val(a)
        } else {
            if (b == "newOrderIELTSLS") {
                c = $("#newOrderPriceIELTSLS").val();
                a = $("#bmfSelectIELTSLS").val();
                $("#bmfcountIELTSLS").val(a)
            } else {
                if (b == "rescheduleOrder") {
                    c = $("#rescheduleOrderPrice").val();
                    a = $("#zkfSelect").val();
                    $("#zkfcount").val(a)
                } else {
                    if (b == "eorOrder") {
                        c = $("#eorFeePrice").val();
                        a = $("#fyfSelect").val();
                        $("#fyfcount").val(a)
                    } else {
                        if (b == "lseorOrder") {
                            c = $("#lseorFeePrice").val();
                            a = $("#lsfyfSelect").val();
                            $("#lsfyfcount").val(a)
                        } else {
                            if (b == "rtiOrder") {
                                c = $("#rtiFeePrice").val();
                                a = $("#rtiSelect").val();
                                $("#rticount").val(a)
                            }
                        }
                    }
                }
            }
        }
    }
    return c * a
}

function submitPayForm(b) {
    $("#paymentForm").submit();
    var a = "<p>";
    a += "请您在打开的新页面中完成支付。</p>";
    a += "<p>支付完成前请不要关闭此窗口。</p>";
    layer.open({
        title: b,
        btn: ["已成功完成支付，返回报名系统", "重新选择支付款项"],
        closeBtn: 0,
        icon: 0,
        content: a,
        area: ["500px", "400x"],
        btn1: function(c) {
            layer.closeAll();
            changePage("#!/homepage", true)
        },
        btn2: function(c) {
            layer.closeAll()
        }
    })
}

function pay(b) {
    if ($("#hiddenAmount").val() == 0) {
        showMsgError("提示信息", "确定", "请选择您要充值的款项类别并且待支付总金额不为0。");
        return false
    }
    var a = "<p>";
    a += "充值金额为：" + $("#total").text();
    a += "</p>";
    a += "<p>您确定进行充值吗？</p>";
    showMsgAsk("提示信息", "cn", a, function() {
        if ($("#hiddenAmount").val() == 0) {
            return
        }
        submitPayForm(b)
    })
}

function pay_tip(c, a) {
    if ($("#hiddenAmount").val() == 0) {
        showMsgError("提示信息", "确定", "请选择您要充值的款项类别并且待支付总金额不为0。");
        return false
    }
    var b = "<p>由于您的余额不足，请先充值。</p>";
    b += "<p>充值金额为：" + $("#total").text();
    b += "</p>";
    b += "<p>您确定进行充值吗？</p>";
    showMsgAsk(c, "cn", b, function() {
        if ($("#hiddenAmount").val() == 0) {
            return
        }
        submitPayForm_tip(c, a)
    })
}

function submitPayForm_tip(c, a) {
    $("#paymentForm").submit();
    var b = "<p>";
    b += "请您在打开的新页面中完成支付。</p>";
    b += "<p>支付完成前请不要关闭此窗口。</p>";
    layer.open({
        title: c,
        btn: ["充值完成，继续操作", "放弃操作"],
        closeBtn: 0,
        icon: 0,
        content: b,
        area: ["500px", "400x"],
        btn1: function(d) {
            layer.closeAll();
            if (isFunction(a)) {
                a()
            }
        },
        btn2: function(d) {
            layer.closeAll()
        }
    })
}

function selCashType(a) {
    $("#reapplyCashGuid").val("");
    $("#reapplyBankForm").hide();
    if (a == "bank") {
        $("#cardForm").hide();
        $("#bankForm").show();
        formatCurrencyVal("balanceField1", $("#balance").val())
    } else {
        if (a == "card") {
            $("#bankForm").hide();
            $("#cardForm").show();
            formatCurrency("balanceField2", $("#balance").val());
            $(".moneyFormatField").each(function() {
                var b = $(this).text();
                $(this).text(b);
                $(this).formatCurrency({
                    region: "zh-CN"
                })
            })
        } else {
            $("#cardForm").hide();
            $("#bankForm").hide()
        }
    }
}

function selCashTypeForTip(a) {
    $("#reapplyCashGuid").val("");
    $("#reapplyBankForm").hide();
    if (a == "bank") {
        layer.open({
            title: "提示信息",
            btn: ["关闭"],
            icon: 3,
            content: "银行转账退款开户人须为考生本人。如开户人姓名与您在报名网站注册的考生姓名不完全一致，请不要“提交退款信息”，尽快与我们联系。电话：010 - 82345671，Email：ielts@mail.neea.edu.cn。",
            btn1: function() {
                layer.closeAll();
                $("#cardForm").hide();
                $("#bankForm").show();
                formatCurrencyVal("balanceField1", $("#balance").val())
            }
        })
    } else {
        if (a == "card") {
            $("#bankForm").hide();
            $("#cardForm").show();
            formatCurrency("balanceField2", $("#balance").val());
            $(".moneyFormatField").each(function() {
                var b = $(this).text();
                $(this).text(b);
                $(this).formatCurrency({
                    region: "zh-CN"
                })
            })
        } else {
            $("#cardForm").hide();
            $("#bankForm").hide()
        }
    }
}

function backFeeChecked(a) {
    var c = "#finID" + a;
    var e = parseInt($("#balance").val());
    var d = parseInt($("#aBackFee" + a).val());
    var f = calculateSumBackFee();
    if (e - f == 0) {
        $(c).removeAttr("checked");
        showMsgError("提示信息", "确定", "已无余额可退款，请不要再选择退款的银行卡。");
        return
    }
    if (getCheckedBackFee()) {
        $(c).attr("checked", true);
        showMsgError("提示信息", "确定", "请点击重新选择按钮，重新选择退款的银行卡。");
        return
    }
    if ($(c).attr("checked")) {
        if (e - f >= d) {
            $("#backFee" + a).val(d);
            formatCurrency("backFeeView" + a, d)
        } else {
            $("#backFee" + a).val(e - f);
            formatCurrency("backFeeView" + a, e - f)
        }
    } else {
        $("#backFeeView" + a).text("¥0.00");
        $("#backFee" + a).val("0")
    }
    var b = calculateSumBackFee();
    $("#remainBalanceField").text((e - b) / 100).formatCurrency({
        region: "zh-CN"
    })
}

function getCheckedBackFee() {
    var a = false;
    $(':checkbox[name="finID"]:checked').each(function(c) {
        var b = $(this).val();
        if (parseInt($("#backFee" + b).val()) > 0 && parseInt($("#backFee" + b).val()) != parseInt($("#aBackFee" + b).val())) {
            a = true
        }
    });
    return a
}

function calculateSumBackFee() {
    var a = 0;
    $(':checkbox[name="finID"]:checked').each(function(c) {
        var b = $(this).val();
        a += parseInt($("#backFee" + b).val())
    });
    return a
}

function cashMoneyCard() {
    if ($(':checkbox[name="finID"]:checked').length == 0) {
        showMsgError("提示信息", "确定", "请选择要退款的订单号。");
        return false
    } else {
        var b = parseInt($("#balance").val());
        var c = calculateSumBackFee();
        if (b != c) {
            showMsgError("提示信息", "确定", "未退回全部余额，请继续选择。");
            return false
        }
    }
    if (!checkMobileVerify($("#mobileVerifyCodeDisplayByCard").val())) {
        showMsgError("提示信息", "确定", "请填写正确的短信验证码");
        return false
    }
    $("#mobileVerifyCodeByCard").val($("#mobileVerifyCodeDisplayByCard").val());
    var a = "<p>您当前账户余额为：" + $("#balanceField1").val() + "</p>";
    a += "<p>特别提示：请您谨慎选择退款方式，一经确定退款，即进入办理流程，无法撤销申请。<br/><br/>退回原银行卡，意指退款将按照原支付路径退至该订单号对应的银行卡中，请您谨慎选择。为确保退款安全、准确，您须确保所选订单（或支付宝账号）系您<b>本人名下的支付宝或银行账户</b>。<br/><br/>提交退款申请后账户余额将被清零，确定提交退款申请吗？</p>";
    showMsgAsk("提示信息", "cn", a, function() {
        var d = $.map($(':checkbox[name="finID"]:checked'), function(f) {
            var e = $(f).val();
            var g = $("#backFee" + e).val();
            return e + "," + g
        });
        $("#financeIds").val(d.join(","));
        $("#btn_cashMoneyCard").attr("disabled", true);
        $.ajax({
            type: "POST",
            headers: {
                "X-CSRF-TOKEN": $("meta[name='_csrf']").attr("content")
            },
            url: "cashMoneyCard",
            data: $("#frmCashMoneyCard").serialize(),
            success: function(f) {
                $("#main-content").html(f);
                var e = $("#code").val();
                if (e == "CASH-OK") {
                    changePage("#!/showRefundInfo", true)
                } else {
                    $("#cashType").val("card");
                    $("input[name=cashType]:eq(0)").attr("checked", "checked");
                    selCashType("card")
                }
            }
        })
    }, "")
}

function clearSelect() {
    $(':checkbox[name="finID"]:checked').each(function(b) {
        $(this).removeAttr("checked");
        var a = $(this).val();
        $("#backFeeView" + a).text("¥0.00");
        $("#backFee" + a).val("0")
    });
    $("#remainBalanceField").text($("#balanceField2").text())
}

function cancelCashMoney() {
    if (!checkMobileVerify($("#mobileVerifyCodeDisplayByCancel").val())) {
        showMsgError("提示信息", "确定", "请填写正确的短信验证码");
        return false
    }
    $("#mobileVerifyCode").val($("#mobileVerifyCodeDisplayByCancel").val());
    showMsgAsk("提示信息", "cn", "取消退款申请后，您申请的退款金额将恢复到您的账户余额。您确定要取消未处理的退款申请吗？", function() {
        $("#del_tta_btn").attr("disabled", true);
        $.ajax({
            type: "POST",
            headers: {
                "X-CSRF-TOKEN": $("meta[name='_csrf']").attr("content")
            },
            url: "cancelCashMoney",
            data: $("#frmCancelCashMoney").serialize(),
            success: function(b) {
                $("#main-content").html(b);
                var a = $("#code").val();
                showMsgOk("提示信息", "确定", a, function() {
                    changePage("#!/showRefundInfo", true)
                })
            }
        })
    })
}

function reapplyCash(a, b) {
    $("#reapplyBankForm").show();
    $("#reapplyCashGuid").val(a);
    formatCurrencyVal("reapplyAmount", b)
}

function getBankUniteCode() {
    $.ajaxSettings.async = false;
    $.getJSON("getBankUniteCode.json", function(a) {
        bankUniteCodeObj = jQuery.parseJSON(a)
    });
    $.ajaxSettings.async = true
};